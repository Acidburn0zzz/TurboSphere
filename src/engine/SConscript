import os
import sys
import glob

full_import_list ="globalenv localenv IsLinux IsWindows IsDarwin compiler librarydir binarydir"

Import(full_import_list)

files = [
  "engine.cpp",
  "functionload.cpp",
  "loadplugins.cpp",
  "typed_array.cpp",
  "variableregister.cpp",
  "version.cpp",
  "options.c",
]

enginelibs = [
  "t5",
  "graphiccommon",
  "graphicalg",
  "configmanager",
  "v8",
]

if not IsWindows():
  enginelibs+= ["dl"]
  enginelibs+= ["z"]

if IsDarwin():
  files += ["osx_time.m", "osx_messagebox.m"]
  enginelibs += ["objc"]
  localenv.Append(FRAMEWORKS=['Cocoa', 'CoreFoundation'])
  globalenv.Append(FRAMEWORKS=['CoreFoundation'])

localenv.Append(LIBS = enginelibs)

turbosphere = globalenv.Program("turbosphere", source = files, LIBS = enginelibs)

globalenv.Install(binarydir, [turbosphere])

Return("turbosphere")

